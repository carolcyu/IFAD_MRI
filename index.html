<!DOCTYPE html>
<html>
  <head>
    <title>NSP Task 2 I-FAD</title>
    <script src="./jspsych/jspsych.js"></script>
    <script src="./jspsych/plugin-image-keyboard-response.js"></script>
    <script src="./jspsych/plugin-html-keyboard-response.js"></script>
        <script src="./jspsych/plugin-html-button-response.js"></script>
	          <script src="./jspsych/plugin-preload.js"></script>
    <link href="./jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="./jspsych/my_experiment_style_MRI.css">
  </head>
  <body></body>
  <script>
/* TASK INFO: implicit FAD task 4 blocks, 1 per condition, no practice trials; alternative order to implicitFAD-ampsuic.html */

    /* initialize jsPsych */
     var jsPsych = initJsPsych({
        on_finish: function() {
			jsPsych.data.get().localSave('json', 'IFAD_data_task2.json');
      }
    }); 
    /* create timeline */
    var timeline = [];

			    /* define welcome message trial */
	  // Pre load images first, Define image sets
var iaps_neut = ['iaps_neut/6150.jpg', 'iaps_neut/7001.jpg', 'iaps_neut/7002.jpg', 'iaps_neut/7009.jpg', 'iaps_neut/7026.jpg', 'iaps_neut/7052.jpg', 'iaps_neut/7055.jpg', 'iaps_neut/7080.jpg', 'iaps_neut/7100.jpg', 'iaps_neut/7150.jpg', 'iaps_neut/7705.jpg'];
var iaps_neg = ['iaps_neg/1525.jpg', 'iaps_neg/2345_1.jpg', 'iaps_neg/3150.jpg', 'iaps_neg/3170.jpg', 'iaps_neg/7380.jpg', 'iaps_neg/9140.jpg', 'iaps_neg/9184.jpg', 'iaps_neg/9301.jpg', 'iaps_neg/9326.jpg', 'iaps_neg/9611.jpg', 'iaps_neg/9903.jpg'];
var iaps_pos = ['iaps_pos/1463.jpg', 'iaps_pos/1811.jpg', 'iaps_pos/2071.jpg', 'iaps_pos/2154.jpg', 'iaps_pos/4610.jpg', 'iaps_pos/5480.jpg', 'iaps_pos/5829.jpg', 'iaps_pos/7400.jpg', 'iaps_pos/7492.jpg', 'iaps_pos/8380.jpg', 'iaps_pos/8503.jpg'];
var sdvp_stim = ['sdvp/3068.jpg', 'sdvp/6570.jpg', 'sdvp/SDVPS_1.jpg', 'sdvp/SDVPS_2.jpg', 'sdvp/SDVPS_3.jpg', 'sdvp/SDVPS_4.jpg', 'sdvp/SDVPS_5.jpg', 'sdvp/SDVPS_6.jpg', 'sdvp/SDVPS_7.jpg', 'sdvp/SDVPS_8.jpg'];
var symbols = [];
for (var i = 1; i <= 43; i++) { symbols.push('sdvp/symbol' + i + '.jpg'); }

// Combine all images into one array for preloading
var all_images = [].concat(iaps_neut, iaps_neg, iaps_pos, sdvp_stim, symbols, ['img/response_key.png']); 

var preload = {
    type: jsPsychPreload,
    images: all_images,
    message: `
        <div style="text-align:center;">
            <p><strong>Preparing Task...</strong></p>
            <div style="width:300px; height: 20px; background-color: #ddd; margin: auto;">
                <div id="jspsych-preload-progress-bar" style="background-color: #333; height: 20px; width: 0%;"></div>
            </div>
            <p>Please wait until all stimuli are cached.</p>
        </div>`,
    auto_preload: false, // We are manually providing the list for "forced" loading
    continue_after_error: false, // CRITICAL: Stop the task if a file is missing
    error_message: '<p>Error: One or more images failed to load. Please check your file paths and server connection.</p>',
    on_finish: function(data) {
        console.log("Forced Preload Complete. Status:", data.success ? "Success" : "Failed");
    }
};

timeline.push(preload);

			var welcome = { type: jsPsychHtmlKeyboardResponse, 
				stimulus: " <p>Welcome to the Modified Affect-Misattribution Task! </p> <p>Press any button for instructions. </p>",
				    choices: "ALL_KEYS",
      response_ends_trial: true
    };
			timeline.push(welcome);

			var instructions = { type: jsPsychHtmlKeyboardResponse, stimulus: "<p>In this task, an image will appear on the screen followed by a symbol.</p><p>Using the response pad, please rate <strong>HOW PLEASANT a SYMBOL is</strong>, as quickly as you can. </p><p>Try to focus on rating the symbol.</p>", 
				choices: "ALL_KEYS",
      response_ends_trial: true,
      post_trial_gap: 1000 
	};
			timeline.push(instructions);

			var instructions2 = { type: jsPsychHtmlKeyboardResponse, stimulus: "<p>If the symbol is...</p> <p><strong>Very unpleasant</strong>, press the button 1</p><p><strong>Unpleasant</strong>, press the button 2</p><p><strong>Pleasant</strong>, press the button 3</p> <p><strong>Very pleasant</strong>, press the button 4.</p><p> <img src='" + "img/response_key.png' alt='Key'></div></p>", 
				choices: "ALL_KEYS",
      response_ends_trial: true,
      post_trial_gap: 1000 };
			timeline.push(instructions2);

			/*questions for the examiner*/
var questions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<p>If you have questions or concerns, please signal to the examiner. </p> <p>If not, press any button to continue. </p>"
    };
    timeline.push(questions);

/*define trial awaiting for the scanner keyboard button #5 */
var MRIstart ={
  type: jsPsychHtmlKeyboardResponse,
  stimulus: "<p> Please wait while the scanner starts up. This will take 10 seconds. </strong></p>",
  choices: ['5'],
 prompt: "<p> A cross (+) will appear when the task starts. </p>",
 data: {
    task: 'mri_start'},
    on_finish: function(data){
    data.response;
 }
};
timeline.push(MRIstart);
var fixation_start = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  response_ends_trial: false,
  trial_duration: 15000,
  data: {
    task: 'fixation_start'
  }
};	
timeline.push(fixation_start);

			var test_stimulus = [
				{stimulus: 'iaps_neut/6150.jpg', symbol: 'sdvp/symbol33.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7001.jpg', symbol: 'sdvp/symbol34.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7002.jpg', symbol: 'sdvp/symbol35.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7009.jpg', symbol: 'sdvp/symbol36.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7026.jpg', symbol: 'sdvp/symbol37.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7052.jpg', symbol: 'sdvp/symbol38.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7055.jpg', symbol: 'sdvp/symbol39.jpg', condition:'neutral'},
				{stimulus: 'iaps_neut/7080.jpg', symbol: 'sdvp/symbol40.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7100.jpg', symbol: 'sdvp/symbol41.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7150.jpg', symbol: 'sdvp/symbol42.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7705.jpg', symbol: 'sdvp/symbol43.jpg', condition:'neutral'}, 

                {stimulus: 'iaps_neg/1525.jpg', symbol: 'sdvp/symbol9.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/2345_1.jpg', symbol: 'sdvp/symbol10.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/3150.jpg', symbol: 'sdvp/symbol11.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/3170.jpg', symbol: 'sdvp/symbol12.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/7380.jpg', symbol: 'sdvp/symbol13.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9140.jpg', symbol: 'sdvp/symbol14.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9184.jpg', symbol: 'sdvp/symbol15.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9301.jpg', symbol: 'sdvp/symbol16.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9326.jpg', symbol: 'sdvp/symbol17.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9611.jpg', symbol: 'sdvp/symbol18.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9903.jpg', symbol: 'sdvp/symbol19.jpg', condition:'negative'}, 

                {stimulus: 'iaps_pos/1463.jpg', symbol: 'sdvp/symbol20.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/1811.jpg', symbol: 'sdvp/symbol23.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/2071.jpg', symbol: 'sdvp/symbol24.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/2154.jpg', symbol: 'sdvp/symbol25.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/4610.jpg', symbol: 'sdvp/symbol26.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/5480.jpg', symbol: 'sdvp/symbol27.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/5829.jpg', symbol: 'sdvp/symbol28.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7400.jpg', symbol: 'sdvp/symbol29.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/7492.jpg', symbol: 'sdvp/symbol30.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/8380.jpg', symbol: 'sdvp/symbol31.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/8503.jpg', symbol: 'sdvp/symbol32.jpg', condition:'positive'},

				{stimulus: 'sdvp/3068.jpg', symbol: 'sdvp/symbol1.jpg', condition:'suicide'},
                {stimulus: 'sdvp/6570.jpg', symbol: 'sdvp/symbol2.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_1.jpg', symbol: 'sdvp/symbol3.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_2.jpg', symbol: 'sdvp/symbol4.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_3.jpg', symbol: 'sdvp/symbol5.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_4.jpg', symbol: 'sdvp/symbol6.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_5.jpg', symbol: 'sdvp/symbol7.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_6.jpg', symbol: 'sdvp/symbol8.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_7.jpg', symbol: 'sdvp/symbol21.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_8.jpg', symbol: 'sdvp/symbol22.jpg', condition:'suicide'},

                {stimulus: 'iaps_neut/6150.jpg', symbol: 'sdvp/symbol33.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7001.jpg', symbol: 'sdvp/symbol34.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7002.jpg', symbol: 'sdvp/symbol35.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7009.jpg', symbol: 'sdvp/symbol36.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7026.jpg', symbol: 'sdvp/symbol37.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7052.jpg', symbol: 'sdvp/symbol38.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7055.jpg', symbol: 'sdvp/symbol39.jpg', condition:'neutral'},
				{stimulus: 'iaps_neut/7080.jpg', symbol: 'sdvp/symbol40.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7100.jpg', symbol: 'sdvp/symbol41.jpg', condition:'neutral'},
                {stimulus: 'iaps_neut/7150.jpg', symbol: 'sdvp/symbol42.jpg', condition:'neutral'}, 
				{stimulus: 'iaps_neut/7705.jpg', symbol: 'sdvp/symbol43.jpg', condition:'neutral'}, 

                {stimulus: 'sdvp/3068.jpg', symbol: 'sdvp/symbol1.jpg', condition:'suicide'},
                {stimulus: 'sdvp/6570.jpg', symbol: 'sdvp/symbol2.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_1.jpg', symbol: 'sdvp/symbol3.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_2.jpg', symbol: 'sdvp/symbol4.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_3.jpg', symbol: 'sdvp/symbol5.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_4.jpg', symbol: 'sdvp/symbol6.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_5.jpg', symbol: 'sdvp/symbol7.jpg', condition:'suicide'},
                {stimulus: 'sdvp/SDVPS_6.jpg', symbol: 'sdvp/symbol8.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_7.jpg', symbol: 'sdvp/symbol21.jpg', condition:'suicide'}, 
				{stimulus: 'sdvp/SDVPS_8.jpg', symbol: 'sdvp/symbol22.jpg', condition:'suicide'},
                
                {stimulus: 'iaps_pos/1463.jpg', symbol: 'sdvp/symbol20.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/1811.jpg', symbol: 'sdvp/symbol23.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/2071.jpg', symbol: 'sdvp/symbol24.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/2154.jpg', symbol: 'sdvp/symbol25.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/4610.jpg', symbol: 'sdvp/symbol26.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/5480.jpg', symbol: 'sdvp/symbol27.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/5829.jpg', symbol: 'sdvp/symbol28.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/7400.jpg', symbol: 'sdvp/symbol29.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/7492.jpg', symbol: 'sdvp/symbol30.jpg', condition:'positive'}, 
				{stimulus: 'iaps_pos/8380.jpg', symbol: 'sdvp/symbol31.jpg', condition:'positive'},
                {stimulus: 'iaps_pos/8503.jpg', symbol: 'sdvp/symbol32.jpg', condition:'positive'},

                {stimulus: 'iaps_neg/1525.jpg', symbol: 'sdvp/symbol9.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/2345_1.jpg', symbol: 'sdvp/symbol10.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/3150.jpg', symbol: 'sdvp/symbol11.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/3170.jpg', symbol: 'sdvp/symbol12.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/7380.jpg', symbol: 'sdvp/symbol13.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9140.jpg', symbol: 'sdvp/symbol14.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9184.jpg', symbol: 'sdvp/symbol15.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9301.jpg', symbol: 'sdvp/symbol16.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9326.jpg', symbol: 'sdvp/symbol17.jpg', condition:'negative'},
                {stimulus: 'iaps_neg/9611.jpg', symbol: 'sdvp/symbol18.jpg', condition:'negative'}, 
				{stimulus: 'iaps_neg/9903.jpg', symbol: 'sdvp/symbol19.jpg', condition:'negative'}, 

			];

    var fixation = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  response_ends_trial: false,
  trial_duration: 600,
  data: {
    task: 'fixation'
  }
};			
var test = { 
    type: jsPsychImageKeyboardResponse, 
    stimulus: jsPsych.timelineVariable('stimulus'), 
    choices: "NO_KEYS", 
    trial_duration: 95, 
    render_on_canvas: false,
    post_trial_gap: 125, 
    stimulus_height: 650, 
    maintain_aspect_ratio: true,
  response_ends_trial: false,
 };
			
var symbol = { type: jsPsychImageKeyboardResponse, stimulus: jsPsych.timelineVariable('symbol'), choices: "NO_KEYS", trial_duration: 135, maintain_aspect_ratio: true,
  response_ends_trial: false,
  };
			
var response = { 
    type: jsPsychHtmlKeyboardResponse, 
    stimulus: "<p>How would you rate that symbol?</p>",   
    choices: ['1', '2', '3', '4'],
    trial_duration: 1500,
    response_ends_trial: false,
    data: {
        task: 'response',
        prime: jsPsych.timelineVariable('stimulus'), // Records the prime image
        target: jsPsych.timelineVariable('symbol'),   // Records the symbol
        condition: jsPsych.timelineVariable('condition') //Records condition
    }
};

var test_procedure = { 
	timeline: [fixation, test, symbol, response], 
timeline_variables: test_stimulus, 
repetitions: 1, 
randomize_order: false, 
post_trial_gap: 250 };
			timeline.push(test_procedure);

var fixation_end = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  response_ends_trial: false,
  trial_duration: 15000,
  data: {
    task: 'fixation_end'
  }
};	
timeline.push(fixation_end);
var debrief_block = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {

    var trials = jsPsych.data.get().filter({task: 'response'});
    var rt = Math.round(trials.select('rt').mean());

    return '<p>Your average response time was ' + rt + 'ms.</p>' +
      '<p>Press any key to complete the task. We appreciate your time!</p>';

  }
};
timeline.push(debrief_block);
    /* start the experiment */
    jsPsych.run(timeline);
  </script>
</html>
